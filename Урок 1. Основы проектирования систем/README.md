# Производительность

## Основные показатели производительности

---------------------------------------

| Показатель                                    | Описание                                                                             |
|-----------------------------------------------|--------------------------------------------------------------------------------------|
| Задержка (Latency)                            | Время, необходимое для обработки запроса или операции                                |
| Пропускная способность (Throughput)           | Количество запросов или операций, которые система может обработать в единицу времени |
| Время отклика (Response Time)                 | Общее время, необходимое для обработки запроса и получения ответа                    |
| Использование ресурсов (Resource Utilization) | Насколько эффективно система использует свои ресурсы                                 |
| Ошибки и сбои (Errors and Failures)           | Количество ошибок и сбоев, происходящих в системе                                    |
| Масштабируемость (Scalability)                | Способность системы обрабатывать увеличивающуюся нагрузку                            |

Отслеживание и анализ этих показателей производительности имеет решающее значение для обеспечения оптимальной работы и
удовлетворенности пользователей.

## *LOW-LATENCY приложения*

Приложения с низкой задержкой - это приложения, которые требуют очень быстрой обработки данных с минимальной задержкой.
Они чувствительны к времени и должны отвечать на запросы как можно быстрее. Примеры приложений с низкой задержкой
включают:

Торговые системы с высокой частотой
Системы управления в реальном времени
Системы автономного вождения
Онлайн-игры

## *HIGH-THROUGHPUT приложения*

* *Приложения с высокой пропускной способностью* - это приложения, которые должны обрабатывать большое количество
  запросов
  или операций за короткое время. Они оптимизированы для обработки большого объема данных с высокой скоростью. Примеры
  приложений с высокой пропускной способностью включают:

    - Потоковые сервисы (видео, аудио)
    - Социальные сети
    - Системы обработки больших данных
    - Веб-серверы

**Различия между приложениями с низкой задержкой и высокой пропускной способностью**

Основное различие между приложениями с низкой задержкой и высокой пропускной способностью заключается в их приоритетах.
Приложения с низкой задержкой сосредоточены на минимизации времени обработки отдельных запросов, в то время как
приложения с высокой пропускной способностью сосредоточены на обработке как можно большего количества запросов в
секунду.

**Приложения с низкой задержкой:**

- Оптимизация должна фокусироваться на сокращении времени обработки запросов за счет
  использования быстрых алгоритмов, кэширования и минимизации сетевой задержки.

**Приложения с высокой пропускной способностью:**

- Оптимизация должна фокусироваться на увеличении количества обрабатываемых
  запросов за счет горизонтального масштабирования, использования высокопроизводительного оборудования и оптимизации
  кода
  для параллелизма.

## Масштабируемость

-------------------------------

Масштабируемость - это способность приложения справляться с увеличивающейся нагрузкой без существенного снижения
производительности или других характеристик. Масштабируемые приложения могут обрабатывать больше запросов, больше
пользователей или больше данных без необходимости изменять программную реализацию.

* Типы масштабируемости:

    - Вертикальное масштабирование (scale-up): добавление дополнительных ресурсов
      (например, процессоров или оперативной памяти) к одному серверу.
    - Горизонтальное масштабирование (scale-out): добавление дополнительных серверов в систему.


* Факторы, влияющие на масштабируемость:

    - Архитектура приложения: Приложение должно быть спроектировано с учетом масштабируемости, например,
      с использованием микросервисной архитектуры или архитектуры на основе событий.
    - Управление данными: Приложение должно эффективно управлять данными, чтобы избежать узких мест и обеспечить
      согласованность данных при горизонтальном масштабировании.
    - Балансировка нагрузки: Приложение должно использовать механизмы балансировки нагрузки для распределения трафика
      между несколькими серверами.
    - Кэширование: Кэширование часто используемых данных может значительно улучшить производительность и уменьшить
      нагрузку на серверы.
    - Разбиение на разделы: Разбиение данных на более мелкие части, которые можно обрабатывать параллельно, может
      улучшить масштабируемость.


* Преимущества масштабируемых приложений:

    - Улучшение производительности и времени отклика
    - Увеличение пропускной способности и количества пользователей
    - Повышение отказоустойчивости и доступности
    - Упрощение управления и обслуживания
    - Снижение затрат на инфраструктуру

Для обеспечения масштабируемости приложения необходимо тщательно планировать его архитектуру и реализацию. Важно также
проводить регулярные тесты нагрузочного тестирования, чтобы выявить и устранить потенциальные узкие места.

## Параметры нагрузки

| Параметр         | Описание                                    |
|------------------|---------------------------------------------|
| RPS              | Число запросов в секунду                    |
| Трафик           | Объем данных, передаваемых в секунду        |
| DAU              | Количество активных пользователей за день   |
| WAU              | Количество активных пользователей за неделю |
| MAU              | Количество активных пользователей за месяц  |
| Read/Write Ratio | Соотношение операций чтения и записи        |

### 1. Число запросов в секунду (RPS)

RPS (Requests Per Second) - количество запросов, отправляемых в систему в секунду. Этот показатель измеряет объем
нагрузки, которую система должна обрабатывать.

### 2. Трафик (байт/сек)

Трафик измеряет объем данных, передаваемых в систему или из системы в секунду. Он может быть выражен в килобайтах (КБ),
мегабайтах (МБ), гигабайтах (ГБ) или терабайтах (ТБ) в секунду.

### 3. Число активных пользователей (DAU, WAU, MAU)

* DAU (Daily Active Users) - количество уникальных пользователей, использующих систему за день.
* WAU (Weekly Active Users) - количество уникальных пользователей, использующих систему за неделю.
* MAU (Monthly Active Users) - количество уникальных пользователей, использующих систему за месяц.

Эти показатели измеряют популярность и охват системы.

### 4. Соотношение операций чтения и записи (READ/WRITE RATIO)

Это соотношение показывает процент операций чтения по сравнению с количеством операций записи в системе. Оно может
помочь определить баланс между чтением и записью данных и выявить потенциальные узкие места.

## Типы приложений

-----------------------------------

**DATA-INTENSIVE** приложения характеризуются тем, что они работают с большими объемами данных, часто терабайтами или
даже петабайтами. К ним относятся:

* Базы данных и системы управления ими
* Системы обработки больших данных (Hadoop, Spark)
* Системы хранения и поиска данных
* Системы аналитики данных
* Системы виртуализации данных

**COMPUTE-INTENSIVE** приложения требуют больших вычислительных ресурсов для выполнения сложных вычислений. К ним
относятся:

* Научные и инженерные моделирования
* Обработка изображений и видео
* Анализ изображений и распознавание образов
* Машинное обучение и глубокое обучение
* Криптография и шифрование

**MEMORY-INTENSIVE** приложения требуют большого объема памяти для хранения данных в оперативной памяти. К ним
относятся:

* Системы кэширования
* Серверы баз данных в памяти
* Системы обработки изображений
* Системы аналитики в памяти
* Системы обнаружения и предотвращения вторжений

**NETWORK-INTENSIVE** приложения часто обмениваются данными с удаленными серверами или другими приложениями через сеть.
К ним относятся:

* Системы потоковой передачи мультимедиа
* Онлайн-игры
* Системы удаленного рабочего стола
* Системы видеоконференцсвязи
* Системы мониторинга сети

**STREAMING-INTENSIVE** приложения обрабатывают и передают потоки данных в режиме реального времени. К ним относятся:

* Потоковое видео и аудио
* Датчики и системы телеметрии
* Системы обработки событий в реальном времени
* Системы мониторинга и оповещения

**INTERACTIVE-INTENSIVE** приложения требуют быстрой поддержки интерактивных операций с низкой задержкой. К ним
относятся:

* Пользовательские интерфейсы
* Игры
* Системы виртуальной и дополненной реальности
* Системы управления в реальном времени

**LATENCY-SENSITIVE** приложения требуют крайне низкой задержки в обработке данных. К ним относятся:

* Высокочастотная торговля
* Системы управления в реальном времени
* Системы аварийного оповещения
* Системы управления дронами

**TRANSACTIONAL** приложения выполняют атомарные операции с данными, гарантируя целостность и согласованность данных. К
ним относятся:

* Системы онлайн-банкинга
* Системы обработки заказов
* Системы управления запасами
* Системы бухгалтерского учета

**VENDOR-LOCKED** приложения зависят от определенного поставщика или технологии и не могут быть легко перенесены на
другие платформы. К ним относятся:

* Приложения с использованием проприетарных API или форматов файлов
* Приложения с использованием облачных сервисов конкретного поставщика
* Приложения, требующие специализированного оборудованияависят от определенного поставщика или технологии и не могут
  быть легко перенесены на другие платформы.

**STATELESS** приложения

* Stateless приложения - это приложения, которые не сохраняют состояние между запросами. Каждый запрос обрабатывается
  независимо, и предыдущие запросы не влияют на обработку текущего запроса. Это упрощает масштабирование и разработку
  stateless приложений, поскольку они могут быть легко распределены по нескольким серверам без необходимости
  синхронизации
  состояния.

- Примеры stateless приложений:

    * Веб-серверы
    * Кэширующие сервисы
    * Системы потоковой передачи

- Преимущества stateless приложений:

    * Легкое масштабирование: Stateless приложения можно легко масштабировать горизонтально, добавляя дополнительные
      серверы,
      поскольку они не зависят от состояния.
    * Повышенная отказоустойчивость: Если сервер с состоянием выходит из строя, stateless приложение может продолжать
      работать
      без потери данных.
    * Простота разработки: Stateless приложения проще разрабатывать и тестировать, поскольку не нужно беспокоиться о
      сохранении и синхронизации состояния.

**STATEFULL** приложения

* Stateful приложения сохраняют состояние между запросами. Это означает, что обработка текущего запроса зависит от
  результатов предыдущих запросов. Stateful приложения требуют механизмов для управления и синхронизации состояния, что
  усложняет их масштабирование и разработку.

- Примеры stateful приложений:

    * Системы управления контентом
    * Системы электронной коммерции
    * Системы социальных сетей

- Преимущества stateful приложений:

    * Улучшенная производительность: Stateful приложения могут кэшировать данные и результаты предыдущих запросов, что
      может
      улучшить производительность.
    * Настройка на основе пользователя: Stateful приложения могут персонализировать пользовательский интерфейс и опыт на
      основе истории взаимодействий пользователя с приложением.
    * Сложная логика: Stateful приложения позволяют реализовать более сложную логику, которая зависит от предыдущих
      действий
      пользователя.

## Масштабирование

--------------------------------------------------------

### **Вертикальное масштабирование (Scale-Up)**

Вертикальное масштабирование - это подход к масштабированию, при котором ресурсы добавляются к одному физическому
серверу или виртуальной машине. Это достигается путем добавления дополнительных процессоров, увеличения объема
оперативной памяти или расширения емкости хранилища.

**Преимущества вертикального масштабирования:**

* Простота реализации
    * Низкая стоимость на начальных этапах

**Недостатки вертикального масштабирования:**

* **Нелинейный рост стоимости:** По мере добавления ресурсов к одному серверу стоимость увеличения мощности растет
  непропорционально.
    * **Ограниченная масштабируемость:** Существуют физические ограничения на количество ресурсов, которые можно
      добавить к одному серверу.
    * **Возможный простой:** Добавление или замена ресурсов может привести к простою сервера, что влияет на доступность
      системы.
    * **Единая точка отказа:** Все ресурсы системы сосредоточены на одном сервере, что создает единую точку отказа.

**Когда использовать вертикальное масштабирование:**

Вертикальное масштабирование подходит для сценариев, когда:

* Необходим быстрый и простой способ масштабирования
    * Необходимы минимальные затраты на начальном этапе
    * Масштабирование требуется в течение короткого периода времени

**Альтернативы вертикальному масштабированию:**

Для преодоления ограничений вертикального масштабирования можно рассмотреть следующие альтернативы:

* **Горизонтальное масштабирование:** Добавление дополнительных серверов или виртуальных машин в систему.
* **Облачные сервисы:** Использование эластичных облачных ресурсов, которые можно увеличивать или уменьшать по мере
  необходимости.

### Горизонтальное масштабирование (Scale-Out)

Горизонтальное масштабирование - это подход к масштабированию, при котором добавляются дополнительные серверы или
виртуальные машины (ВМ) в систему. Это позволяет распределять нагрузку между несколькими ресурсами, повышая
производительность и отказоустойчивость.

**Преимущества горизонтального масштабирования:**

* **Линейный рост стоимости:** Стоимость масштабирования пропорциональна количеству добавленных серверов или ВМ.
* **Высокая масштабируемость:** Горизонтальное масштабирование практически не ограничено, поскольку можно добавлять
  столько серверов или ВМ, сколько необходимо.
* **Повышенная отказоустойчивость:** Если один сервер или ВМ выходит из строя, другие могут продолжать обрабатывать
  запросы, обеспечивая высокую доступность.

**Недостатки горизонтального масштабирования:**

* **Более сложная реализация:** Настройка и управление несколькими серверами или ВМ может быть более сложными, чем
  вертикальное масштабирование.
* **Возможная несогласованность данных:** При использовании горизонтального масштабирования необходимо обеспечить
  согласованность данных между несколькими серверами или ВМ.

**Горизонтальное масштабирование подходит для сценариев, когда:**

* **Необходима высокая масштабируемость**
* **Важна высокая доступность**
* **Стоимость масштабирования является линейной**

### Облачные сервисы

Облачные сервисы предоставляют эластичные вычислительные ресурсы, которые можно увеличивать или уменьшать по мере
необходимости. Это позволяет пользователям масштабировать свои приложения и инфраструктуру без необходимости приобретать
и обслуживать собственные серверы.

**Преимущества облачных сервисов:**

* **Эластичность:** Облачные ресурсы можно быстро и легко масштабировать в зависимости от изменяющихся потребностей.
  Платеж по факту использования: Пользователи платят только за те ресурсы, которые они используют, что может снизить
  затраты по сравнению с традиционными моделями размещения.
* **Доступность по требованию:** Облачные ресурсы доступны по требованию, что позволяет пользователям разворачивать и
  масштабировать свои приложения по мере необходимости.

**Недостатки облачных сервисов:**

* **Зависимость от стороннего поставщика:** Облачные сервисы зависят от стороннего поставщика, что может привести к
  проблемам
  с доступностью или безопасностью.
* **Стоимость:** Использование облачных сервисов может быть дороже, чем размещение приложений на собственных серверах,
  особенно для приложений с большими требованиями к ресурсам.

**Облачные сервисы подходят для сценариев, когда:**

* Необходима эластичность и масштабируемость по требованию
  Важна оптимизация затрат
* Желательно избежать затрат на приобретение и обслуживание серверов

## Отказоустойчивость

---------------


Отказоустойчивость - это способность системы продолжать функционировать корректно в присутствии отказов компонентов.

**Обеспечение отказоустойчивости**

* **Избыточность на аппаратном уровне:** Дублирование или резервирование критически важных компонентов, таких как
  серверы, диски и сетевое оборудование.
* **Обнаружение и обработка отказа на программном уровне:** Использование механизмов для обнаружения и обработки сбоев,
  например, мониторинг состояния системы, автоматическое переключение и восстановление.
* **Прогнозирование и предотвращение отказа:** Анализ данных эксплуатационных характеристик для выявления потенциальных
  точек отказа и принятие превентивных мер.

### Доступность

Доступность системы - это мера того, насколько пользователи могут взаимодействовать с системой и получать корректные
ответы в приемлемое время.

**Измерение доступности**

Доступность измеряется в **Nine's**, которые представляют процент времени, когда система доступна:

| Название                        | Количество девяток (Nine's) | Процент доступности | Время недоступности в год |
|---------------------------------|-----------------------------|---------------------|---------------------------|
| Низкая доступность              | 99%                         | 0,99                | 3,65 дня                  |
| Хорошая доступность             | 99,9%                       | 0,999               | 8,76 часа                 |
| Высокая доступность             | 99,99%                      | 0,9999              | 52,6 минуты               |
| Очень высокая доступность       | 99,999%                     | 0,99999             | 5,26 минуты               |
| Чрезвычайно высокая доступность | 99,9999%                    | 0,999999            | 31,5 секунды              |

**Обеспечение высокой доступности**

* Устранение единых точек отказа
* Обеспечение избыточности на всех уровнях системы
* Ускорение восстановления после сбоев
* Регулярное проведение тестов на доступность

**SLA (Service Level Agreement)**

SLA (Service Level Agreement) - это соглашение между поставщиком услуги и клиентом, которое определяет уровень
обслуживания, ожидаемый клиентом. SLA обычно включает в себя метрики, такие как доступность, производительность и время
отклика, а также согласованные уровни этих метрик. Невыполнение SLA может привести к штрафам или другим последствиям для
поставщика услуги.

**SLO (Service Level Objective)**

SLO (Service Level Objective) - это внутренняя цель, которую устанавливает поставщик услуги для обеспечения
определенного уровня обслуживания. SLO часто используется для отслеживания прогресса в достижении целей SLA. SLO могут
быть более детальными и гибкими, чем SLA, и могут использоваться для оптимизации производительности службы.

**SLI (Service Level Indicator)**

SLI (Service Level Indicator) - это метрика, которая измеряет фактический уровень обслуживания, предоставляемого
поставщиком услуги. SLI собираются и анализируются для оценки производительности службы и определения того,
соответствует ли она согласованным SLO и SLA.

**Взаимосвязь между SLA, SLO и SLI**

* SLA устанавливает ожидания клиентов относительно уровня обслуживания.
* SLO определяет внутренние цели поставщика услуги для достижения уровня обслуживания, указанного в SLA.
* SLI отслеживают фактический уровень обслуживания, предоставляемого поставщиком услуги, и позволяют сравнить его с SLO
  и SLA.

Используя SLA, SLO и SLI вместе, поставщики услуг могут согласовывать ожидания клиентов, устанавливать измеримые цели и
отслеживать производительность своих услуг, обеспечивая соответствие согласованным уровням обслуживания.

## Удобство сопровождения

-------------

- **Возможность обновления без простоя (downtime)**

    * Система спроектирована для обновления без прерывания работы пользователей.
      Обновления можно проводить поэтапно, чтобы минимизировать влияние на доступность системы.


- **Возможность отключения части машин без прерывания работы**

    * Система спроектирована с архитектурой высокой доступности, которая позволяет отключать части машин для
      обслуживания или
      устранения неполадок без влияния на доступность службы.
      Используются механизмы балансировки нагрузки и резервирования для распределения запросов между доступными
      машинами.


- **Удобный мониторинг системы и подробное логирование**

    * Система предоставляет инструменты для мониторинга всех аспектов системы, включая производительность, использование
      ресурсов и состояние компонентов.
    * Ведется подробное логирование событий и ошибок, что облегчает диагностику и устранение проблем.


- **Быстрая диагностика и устранение проблем**

    * Система предоставляет инструменты и документацию для быстрого выявления и устранения проблем.
      Она спроектирована с возможностью разделения на модули, что упрощает локализацию и исправление проблем.


- **Легкость расширения системы**

    * Система спроектирована с возможностью расширения, позволяя легко добавлять новые функции или увеличивать емкость
      по мере
      роста требований.
      Она использует модульную архитектуру и стандартизированные интерфейсы, что облегчает интеграцию новых компонентов.

## Балансировка нагрузки

-----------------------

Балансировка нагрузки - это процесс распределения запросов между несколькими серверами или другими ресурсами для
оптимизации использования ресурсов и обеспечения высокой доступности. Существует несколько методов балансировки
нагрузки:

* **Round Robin (По круговой):** Запросы распределяются по серверам по очереди. Этот метод простой и легко реализуемый,
  но он не учитывает загрузку серверов.

    ```mermaid
        sequenceDiagram
        participant Client
        participant Server1
        participant Server2
        participant Server3
        
        Client->Server1: Request 1
        Server1->Client: Response 1
        Client->Server2: Request 2
        Server2->Client: Response 2
        Client->Server3: Request 3
        Server3->Client: Response 3
        Client->Server1: Request 4
        Server1->Client: Response 4
        Client->Server2: Request 5
        Server2->Client: Response 5
        Client->Server3: Request 6
        Server3->Client: Response 6
    ```

* **Weighted Round Robin (Взвешенный по круговой):** Улучшение метода Round Robin, которое позволяет назначать
  разный
  вес разным серверам в зависимости от их емкости или производительности.

  ``` mermaid
      sequenceDiagram
      participant Client
      participant Server1 weight=2
      participant Server2 weight=1
      participant Server3 weight=3
      
      Client->Server1: Request 1
      Server1->Client: Response 1
      Client->Server2: Request 2
      Server2->Client: Response 2
      Client->Server3: Request 3
      Server3->Client: Response 3
      Client->Server1: Request 4
      Server1->Client: Response 4
      Client->Server2: Request 5
      Server2->Client: Response 5
      Client->Server3: Request 6
      Server3->Client: Response 6
      Client->Server3: Request 7
      Server3->Client: Response 7
      Client->Server1: Request 8
      Server1->Client: Response 8
  ```
* **Sticky session** - метод балансировки нагрузки, который гарантирует, что все запросы от одного клиента направляются
  на один и тот же сервер. Это полезно для приложений, которым требуется сохранять состояние сеанса на стороне сервера,
  например, для интернет-магазинов или банковских приложений

    ```mermaid
    sequenceDiagram
    participant Client
    participant Server
    Note over Client,Server: Sticky Session
    
    Client->Server: Request 1
    Server->Client: Response 1
    Client->Server: Request 2
    Server->Client: Response 2
    Client->Server: Request 3
    Server->Client: Response 3


    ```    


* **Least Connections (Наименьшее число соединений):** Запросы направляются на сервер с наименьшим количеством активных
  соединений. Этот метод помогает распределять нагрузку более равномерно.

    ```mermaid
        sequenceDiagram
        participant Client
        participant Server1
        participant Server2
        participant Server3
        participant Load Balancer
        
        Client->Load Balancer: Request
        Load Balancer->Server1: Check load
        Server1->Load Balancer: 2 active connections
        Load Balancer->Server2: Check load
        Server2->Load Balancer: 3 active connections
        Load Balancer->Server3: Check load
        Server3->Load Balancer: 1 active connection
        Load Balancer->Client: Server3 assigned
        Client->Server3: Request 1
        Server3->Client: Response 1
        Client->Server3: Request 2
        Server3->Client: Response 2
        Client->Server3: Request 3
        Server3->Client: Response 3
  
    ```

* **Least Response Time (Наименьшее время отклика):** Запросы направляются на сервер с наименьшим временем отклика при
  обработке предыдущих запросов. Этот метод обеспечивает более быструю обработку запросов.

    ```mermaid
        sequenceDiagram
    participant Client
    participant Server1
    participant Server2
    participant Server3
    participant Load Balancer
    
    Client->Load Balancer: Request
    Load Balancer->Server1: Check load and response time
    Server1->Load Balancer: 2 active connections, 100ms response time
    Load Balancer->Server2: Check load and response time
    Server2->Load Balancer: 3 active connections, 150ms response time
    Load Balancer->Server3: Check load and response time
    Server3->Load Balancer: 1 active connection, 50ms response time
    Load Balancer->Client: Server3 assigned
    Client->Server3: Request 1
    Server3->Client: Response 1
    Client->Server3: Request 2
    Server3->Client: Response 2
    Client->Server3: Request 3
    Server3->Client: Response 3
    ```
* **IP Hashing (Хеширование IP-адресов):** Запросы от одного клиента всегда направляются на один и тот же сервер на
  основе хеша IP-адреса клиента. Это обеспечивает согласованность сеанса и снижает нагрузку на другие серверы.

### Алгоритмы балансировки нагрузки

Существует несколько алгоритмов, которые можно использовать для реализации методов балансировки нагрузки:

* **Random:** Запросы распределяются случайным образом между серверами.
* **Weighted Random:** Запросы распределяются случайным образом, но с весами, назначенными серверам.
* **Least Connections:** Выбирается сервер с наименьшим количеством активных соединений.
* **Least Response Time:** Выбирается сервер с наименьшим временем отклика, измеренным по предыдущим запросам.
* **Consistent Hashing:** Запросы хешируются, и сервер выбирается на основе хеша запроса.

### Решения для балансировки нагрузки

Существует несколько аппаратных и программных решений для балансировки нагрузки:

* **Аппаратные балансировщики нагрузки:** Специализированные устройства, предназначенные для распределения нагрузки
  между серверами. Они обеспечивают высокую производительность и отказоустойчивость.
* **Программные балансировщики нагрузки:** Программное обеспечение, которое работает на обычных серверах и распределяет
  нагрузку между ними. Они более гибкие и настраиваемые, но могут иметь более низкую производительность, чем аппаратные
  балансировщики.
* **Облачные службы балансировки нагрузки:** Управляемые облачные сервисы, которые предоставляют функции балансировки
  нагрузки без необходимости развертывать и обслуживать собственные решения.

